{"ast":null,"code":"import { pdfjs } from \"react-pdf\";\nimport { FILE_BASE_URL } from \"../constants\";\nimport store from \"../store/store\";\nimport { setPDFImages } from \"../actions/file\";\nimport { updatePDFSettings } from \"../actions/settings\";\npdfjs.GlobalWorkerOptions.workerSrc = \"https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.js\";\nlet loadingDocIdtTask;\nlet idtPageCount = 0;\nconst get = id => document.getElementById(id);\nconst renderDocIdtPageToCanvasesLoop = async (pdfDoc, index) => {\n  const images = [];\n  const length = pdfDoc.numPages;\n  let pageX = 0;\n  let pageY = 0;\n  for (let i = 0; i < length; i++) {\n    const canvname = \"page\" + i;\n    const thepage = i + 1;\n    const theCanvas = get(canvname);\n    const ctx = theCanvas.getContext(\"2d\", {\n      alpha: false\n    });\n    const page = await pdfDoc.getPage(thepage);\n    const viewport = page.getViewport({\n      scale: 2\n    });\n    theCanvas.height = viewport.height;\n    theCanvas.width = viewport.width;\n    const renderContext = {\n      canvasContext: ctx,\n      viewport: viewport\n    };\n    const renderTask = page.render({\n      ...renderContext\n    });\n    await renderTask.promise;\n    const {\n      view = []\n    } = page._pageInfo || {};\n    pageX = view[2] || 0;\n    pageY = view[3] || 0;\n    images.push({\n      image: ctx.canvas.toDataURL(),\n      height: pageY,\n      width: pageX\n    });\n  }\n  for (let p = 0; p < length; p++) {\n    const el = get(\"page\" + p);\n    el.parentNode.removeChild(el);\n  }\n  store.dispatch(setPDFImages(images));\n  store.dispatch(updatePDFSettings({\n    index,\n    maxx: pageX * 2,\n    maxy: pageY * 2,\n    total: length\n  }));\n};\nexport const loadPDF = async (file, index, cb) => {\n  const filename = FILE_BASE_URL + \"/\" + file;\n  const res = await processLoadIdtPDFJSON(filename, index);\n  if (cb) {\n    cb();\n  }\n  return res;\n};\nasync function processLoadIdtPDFJSON(url, index) {\n  loadingDocIdtTask = pdfjs.getDocument({\n    url\n  });\n  const pdfDoc = await loadingDocIdtTask.promise;\n  for (let p = 0; p < pdfDoc.numPages; p++) {\n    const elCanvas = document.createElement(\"canvas\");\n    elCanvas.id = \"page\" + p;\n    elCanvas.className = \"hidden\";\n    const body = get(\"body\");\n    body === null || body === void 0 ? void 0 : body.appendChild(elCanvas);\n  }\n  await renderDocIdtPageToCanvasesLoop(pdfDoc, index);\n}","map":{"version":3,"names":["pdfjs","FILE_BASE_URL","store","setPDFImages","updatePDFSettings","GlobalWorkerOptions","workerSrc","loadingDocIdtTask","idtPageCount","get","id","document","getElementById","renderDocIdtPageToCanvasesLoop","pdfDoc","index","images","length","numPages","pageX","pageY","i","canvname","thepage","theCanvas","ctx","getContext","alpha","page","getPage","viewport","getViewport","scale","height","width","renderContext","canvasContext","renderTask","render","promise","view","_pageInfo","push","image","canvas","toDataURL","p","el","parentNode","removeChild","dispatch","maxx","maxy","total","loadPDF","file","cb","filename","res","processLoadIdtPDFJSON","url","getDocument","elCanvas","createElement","className","body","appendChild"],"sources":["/home/tk-lpt-739/Downloads/eDOCSigAdminReact/eDOCSigAdminReact/src/helpers/loadDoc.ts"],"sourcesContent":["import { PDFDocumentProxy, RenderTask } from \"pdfjs-dist\";\r\nimport { pdfjs } from \"react-pdf\";\r\nimport { FILE_BASE_URL } from \"../constants\";\r\nimport store from \"../store/store\";\r\nimport { setPDFImages } from \"../actions/file\";\r\nimport { updatePDFSettings } from \"../actions/settings\";\r\n\r\npdfjs.GlobalWorkerOptions.workerSrc =\r\n  \"https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.js\";\r\n\r\nlet loadingDocIdtTask;\r\nlet idtPageCount = 0;\r\n\r\nconst get = (id: string) => document.getElementById(id);\r\n\r\nconst renderDocIdtPageToCanvasesLoop = async (\r\n  pdfDoc: PDFDocumentProxy,\r\n  index: number\r\n) => {\r\n  const images = [];\r\n  const length = pdfDoc.numPages;\r\n  let pageX = 0;\r\n  let pageY = 0;\r\n  for (let i = 0; i < length; i++) {\r\n    const canvname = \"page\" + i;\r\n    const thepage = i + 1;\r\n    const theCanvas = get(canvname) as HTMLCanvasElement;\r\n    const ctx = theCanvas.getContext(\"2d\", {\r\n      alpha: false,\r\n    });\r\n\r\n    const page = await pdfDoc.getPage(thepage);\r\n    const viewport = page.getViewport({\r\n      scale: 2,\r\n    });\r\n\r\n    theCanvas.height = viewport.height;\r\n    theCanvas.width = viewport.width;\r\n\r\n    const renderContext = {\r\n      canvasContext: ctx!,\r\n      viewport: viewport,\r\n    };\r\n\r\n    const renderTask: RenderTask = page.render({ ...renderContext });\r\n\r\n    await renderTask.promise;\r\n\r\n    const { view = [] } = page._pageInfo || {};\r\n    pageX = view[2] || 0;\r\n    pageY = view[3] || 0;\r\n\r\n    images.push({\r\n      image: ctx!.canvas.toDataURL(),\r\n      height: pageY,\r\n      width: pageX,\r\n    });\r\n  }\r\n  for (let p = 0; p < length; p++) {\r\n    const el: any = get(\"page\" + p);\r\n    el.parentNode.removeChild(el);\r\n  }\r\n  store.dispatch(setPDFImages(images));\r\n  store.dispatch(\r\n    updatePDFSettings({\r\n      index,\r\n      maxx: pageX * 2,\r\n      maxy: pageY * 2,\r\n      total: length,\r\n    })\r\n  );\r\n};\r\n\r\nexport const loadPDF = async (file: string, index: number, cb?: () => void) => {\r\n  const filename = FILE_BASE_URL + \"/\" + file;\r\n  const res = await processLoadIdtPDFJSON(filename, index);\r\n  if (cb) {\r\n    cb();\r\n  }\r\n  return res;\r\n};\r\n\r\nasync function processLoadIdtPDFJSON(url: string, index: number) {\r\n  loadingDocIdtTask = pdfjs.getDocument({ url });\r\n  const pdfDoc = await loadingDocIdtTask.promise;\r\n  for (let p = 0; p < pdfDoc.numPages; p++) {\r\n    const elCanvas = document.createElement(\"canvas\");\r\n    elCanvas.id = \"page\" + p;\r\n    elCanvas.className = \"hidden\";\r\n    const body = get(\"body\");\r\n    body?.appendChild(elCanvas);\r\n  }\r\n  await renderDocIdtPageToCanvasesLoop(pdfDoc, index);\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
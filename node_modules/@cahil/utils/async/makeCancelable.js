"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = makeCancelable;
exports.canceledError = void 0;

/**
 * @module async
 */

/** An error that indicates a promise has rejected because it was canceled */
var canceledError = {
  isCanceled: true
};
/** A promise that can have it's resolution cancelled */

exports.canceledError = canceledError;

/**
 *
 * Allows the provided promise to be canceled after starting. This does not stop the promise from executing but will
 * cause it to reject with the value `{ isCanceled: true }` once it finishes, regardless of outcome.
 *
 * @param promise The promise that is executing
 * @return The cancelable version of the promise
 *
 * @example
 * ```typescript
 *
 * const promise = new Promise((res, rej) => {
 *   setTimeout(() => res('I finished!'), 3000)
 * })
 *
 * // Create a cancelable version of the promise
 * const cancelablePromise = makeCancelable(promise)
 *
 * // Stop the cancelable promise from resolving
 * cancelablePromise.cancel()
 *
 * promise
 *   .then(result => console.log('Normal', result)) // This will log `'I finished!'` after 3000ms
 *   .catch(err => console.log('Normal', err)) // Will reject as per normal
 *
 * cancelablePromise
 *   .then(result => console.log('Cancelable', result)) // Never fires, the promise will not resolve after being cancelled
 *   .catch(err => console.log('Cancelable', err)) // Resolves after 3000ms with the value `{ isCanceled: true }`
 * ```
 *
 */
function makeCancelable(promise) {
  var hasCanceled = false;
  var cancelablePromise = new Promise(function (resolve, reject) {
    promise.then(function (val) {
      return hasCanceled ? reject(canceledError) : resolve(val);
    }, function (error) {
      return hasCanceled ? reject(canceledError) : reject(error);
    });
  });

  cancelablePromise.cancel = function () {
    hasCanceled = true;
  };

  return cancelablePromise;
}

module.exports = makeCancelable;
module.exports.makeCancelable = makeCancelable;
module.exports["default"] = makeCancelable;